service cloud.firestore {
  match /databases/{database}/documents {
    // Admin only: full access to users collection
    match /users/{userId} {
      allow create: if request.auth != null && request.auth.token.admin == true;
      allow update, delete: if request.auth != null && request.auth.token.admin == true;
      // Clients may read/write only their own user document
      allow read: if request.auth != null && request.auth.uid == userId;
    }

    // Wedding RSVPs: public documents under a client's 'wedding_rsvps'
    match /artifacts/{projectId}/public/data/wedding_rsvps/{rsvpId} {
      // Anyone authenticated may create an RSVP
      allow create: if request.auth != null;
      // Only the client/admin may read RSVP counts
      allow read: if request.auth != null && (request.auth.token.admin == true || request.auth.token.clientId == projectId);
      allow update, delete: if false; // No updates or deletes once created
    }

    // Deny all other access by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
